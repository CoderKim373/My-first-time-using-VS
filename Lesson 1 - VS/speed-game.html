<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speed Run - The Sonic Team</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: url('https://wallpaperaccess.com/full/1086060.jpg') center/cover no-repeat fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
        }
        
        .game-container {
            text-align: center;
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        canvas {
            border: 3px solid #333;
            border-radius: 10px;
            background: url('https://i.pinimg.com/1200x/2d/19/1e/2d191e8631ce581a0d584a2d861501bd.jpg') center/cover no-repeat;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.2);
        }
        
        .score {
            font-size: 24px;
            font-weight: bold;
            color: #ff9800;
            margin: 10px 0;
        }
        
        .back-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        
        .back-btn:hover {
            background: #1976d2;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>⚡ Speed Run</h1>
        <div class="score">Distance: <span id="distance">0</span>m | Speed: <span id="speed">0</span></div>
        <canvas id="gameCanvas" width="600" height="400"></canvas>
        <div class="controls">
            <p>Use ARROW KEYS to navigate! Avoid obstacles!</p>
            <p>Playing as: <strong id="character"></strong></p>
        </div>
        <button class="back-btn" onclick="window.location.href='arcade.html'">← Back to Arcade</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const distanceElement = document.getElementById('distance');
        const speedElement = document.getElementById('speed');
        const characterElement = document.getElementById('character');
        
        // Get selected character
        const character = localStorage.getItem('selectedCharacter') || 'sonic';
        characterElement.textContent = character.toUpperCase();
        
        // Character colors
        const colors = {
            sonic: '#0066ff',
            tails: '#ff9900',
            knuckles: '#ff0000',
            shadow: '#333333'
        };
        
        // Game variables
        let player = {
            x: 100,
            y: canvas.height - 80,
            width: 50,
            height: 50,
            velocityY: 0,
            onGround: true,
            speed: 5
        };
        
        let obstacles = [];
        let loops = [];
        let distance = 0;
        let gameSpeed = 3;
        let gameRunning = true;
        let keys = {};
        
        // Create obstacle
        function createObstacle() {
            obstacles.push({
                x: canvas.width,
                y: canvas.height - 60,
                width: 30,
                height: 30,
                type: 'spike'
            });
        }
        
        // Create loop
        function createLoop() {
            loops.push({
                x: canvas.width,
                y: canvas.height - 150,
                radius: 50,
                centerY: canvas.height - 100
            });
        }
        
        // Character images
        const characterImages = {
            sonic: 'https://i.pinimg.com/736x/d0/99/ef/d099ef42e201aecf8fe0c80a9794c482.jpg',
            tails: 'https://i.pinimg.com/736x/9a/b0/7c/9ab07c52c48cf956abbba65bbf11e138.jpg',
            knuckles: 'https://i.pinimg.com/736x/49/65/58/496558595c344aca8692a493b2840d1a.jpg',
            shadow: 'https://i.pinimg.com/736x/d0/d5/f9/d0d5f9fb8be66f1682bb67978c08711b.jpg'
        };
        
        let characterImg = new Image();
        characterImg.src = characterImages[character];
        
        // Draw player
        function drawPlayer() {
            // Speed trail effect
            ctx.fillStyle = colors[character] + '40';
            for (let i = 1; i <= 5; i++) {
                ctx.beginPath();
                ctx.arc(player.x - i * 8 + player.width/2, player.y + player.height/2, player.width/2 - i, 0, Math.PI * 2);
                ctx.fill();
            }
            
            if (characterImg.complete) {
                ctx.drawImage(characterImg, player.x, player.y, player.width, player.height);
            } else {
                // Fallback circle
                ctx.fillStyle = colors[character];
                ctx.beginPath();
                ctx.arc(player.x + player.width/2, player.y + player.height/2, player.width/2, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Super speed aura
            ctx.strokeStyle = '#00aaff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(player.x + player.width/2, player.y + player.height/2, player.width/2 + 5, 0, Math.PI * 2);
            ctx.stroke();
        }
        
        // Draw ground
        function drawGround() {
            // Ground gradient
            const groundGradient = ctx.createLinearGradient(0, canvas.height - 30, 0, canvas.height);
            groundGradient.addColorStop(0, '#228B22');
            groundGradient.addColorStop(0.3, '#32CD32');
            groundGradient.addColorStop(1, '#8B4513');
            ctx.fillStyle = groundGradient;
            ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
            
            // Checkered pattern like Sonic levels
            ctx.fillStyle = '#90EE90';
            for (let i = 0; i < canvas.width; i += 40) {
                const offset = (distance * gameSpeed * 0.1) % 40;
                ctx.fillRect(i - offset, canvas.height - 30, 20, 30);
            }
            
            // Ground highlights
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.fillRect(0, canvas.height - 30, canvas.width, 3);
        }
        
        // Draw obstacles
        function drawObstacles() {
            ctx.fillStyle = '#f44336';
            obstacles.forEach(obstacle => {
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                
                // Spikes
                ctx.fillStyle = '#d32f2f';
                for (let i = 0; i < obstacle.width; i += 6) {
                    ctx.beginPath();
                    ctx.moveTo(obstacle.x + i, obstacle.y);
                    ctx.lineTo(obstacle.x + i + 3, obstacle.y - 10);
                    ctx.lineTo(obstacle.x + i + 6, obstacle.y);
                    ctx.fill();
                }
                ctx.fillStyle = '#f44336';
            });
        }
        
        // Draw loops
        function drawLoops() {
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 8;
            loops.forEach(loop => {
                ctx.beginPath();
                ctx.arc(loop.x, loop.centerY, loop.radius, 0, Math.PI * 2);
                ctx.stroke();
            });
        }
        
        // Update player
        function updatePlayer() {
            // Gravity
            if (!player.onGround) {
                player.velocityY += 0.8;
            }
            
            // Jump
            if (keys['ArrowUp'] && player.onGround) {
                player.velocityY = -15;
                player.onGround = false;
            }
            
            // Move up/down
            if (keys['ArrowDown'] && player.onGround) {
                // Slide/duck
                player.height = 20;
            } else {
                player.height = 30;
            }
            
            // Apply velocity
            player.y += player.velocityY;
            
            // Ground collision
            if (player.y >= canvas.height - 80) {
                player.y = canvas.height - 80;
                player.velocityY = 0;
                player.onGround = true;
            }
            
            // Update distance and speed
            distance += gameSpeed;
            distanceElement.textContent = Math.floor(distance / 10);
            speedElement.textContent = Math.floor(gameSpeed * 10);
            
            // Increase speed over time
            gameSpeed += 0.001;
        }
        
        // Update obstacles
        function updateObstacles() {
            obstacles.forEach((obstacle, index) => {
                obstacle.x -= gameSpeed;
                
                // Check collision
                if (player.x < obstacle.x + obstacle.width &&
                    player.x + player.width > obstacle.x &&
                    player.y < obstacle.y + obstacle.height &&
                    player.y + player.height > obstacle.y) {
                    gameOver();
                }
                
                // Remove off-screen obstacles
                if (obstacle.x < -obstacle.width) {
                    obstacles.splice(index, 1);
                }
            });
        }
        
        // Update loops
        function updateLoops() {
            loops.forEach((loop, index) => {
                loop.x -= gameSpeed;
                
                // Remove off-screen loops
                if (loop.x < -loop.radius * 2) {
                    loops.splice(index, 1);
                }
            });
        }
        
        // Game over
        function gameOver() {
            gameRunning = false;
            ctx.fillStyle = 'rgba(0,0,0,0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'white';
            ctx.font = '30px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Crashed!', canvas.width/2, canvas.height/2 - 70);
            ctx.fillText(`Distance: ${Math.floor(distance / 10)}m`, canvas.width/2, canvas.height/2 - 30);
            ctx.font = '16px Arial';
            ctx.fillText('Press SPACE to revive or R to restart', canvas.width/2, canvas.height/2 + 20);
        }
        
        function revive() {
            player.x = 100;
            player.y = canvas.height - 80;
            player.velocityY = 0;
            player.onGround = true;
            obstacles = [];
            gameSpeed = 3;
            gameRunning = true;
        }
        
        // Draw everything
        function draw() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawGround();
            drawLoops();
            drawObstacles();
            drawPlayer();
        }
        
        // Game loop
        function gameLoop() {
            if (gameRunning) {
                updatePlayer();
                updateObstacles();
                updateLoops();
                
                // Create new obstacles and loops
                if (Math.random() < 0.015) {
                    createObstacle();
                }
                if (Math.random() < 0.005) {
                    createLoop();
                }
            }
            
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Event listeners
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            
            if (e.code === 'Space' && !gameRunning) {
                revive();
            }
            if (e.code === 'KeyR' && !gameRunning) {
                location.reload();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });
        
        // Start game
        gameLoop();
    </script>
</body>
</html>